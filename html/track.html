<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>音频编码器性能对比</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; overflow-x: auto; }
        h2 { color: #24292e; }
        table { border-collapse: collapse; margin-top: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: center; white-space: nowrap; }
        th { background-color: #f6f8fa; cursor: pointer; position: sticky; top: 0; z-index: 10; }
        th:hover { background-color: #e1e4e8; }
        tr:nth-child(even) { background-color: #f9f9f9; }
        tr:hover { background-color: #f0f7ff; }
        .sort-icon { margin-left: 5px; }
        .loading { color: #586069; font-style: italic; }
    </style>
</head>
<body>
    <h2>音频编码器性能对比表</h2>
    <p>点击任意列头排序 ▲/▼ | </p>
    <div id="loading" class="loading">正在加载数据...</div>
    <div id="table-container" style="overflow-x: auto;"></div>

    <script>
        // 配置
        const config = {
            csvUrl: './data/Track1-MLP.csv',  // CSV文件路径（需与HTML同目录）
            skipRows: 2,               // 跳过前两行元数据
            headerRowIndex: 2,         // 表头在第3行（0-based）
            dataStartRow: 3            // 数据从第4行开始
        };

        // 加载数据
        document.addEventListener('DOMContentLoaded', () => {
            Papa.parse(config.csvUrl, {
                download: true,
                skipEmptyLines: true,
                complete: function(results) {
                    document.getElementById('loading').remove();
                    renderSortableTable(results.data);
                },
                error: function(err) {
                    document.getElementById('loading').textContent = '加载失败: ' + err.message;
                }
            });
        });

        // 渲染表格
        function renderSortableTable(data) {
            const container = document.getElementById('table-container');
            const table = document.createElement('table');
            const thead = document.createElement('thead');
            const tbody = document.createElement('tbody');

            // 处理表头
            const headers = data[config.headerRowIndex].filter(cell => cell.trim() !== '');
            const headerRow = document.createElement('tr');
            
            headers.forEach((header, colIndex) => {
                const th = document.createElement('th');
                th.innerHTML = `${header} <span class="sort-icon">↕</span>`;
                th.onclick = () => sortTable(colIndex, th);
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);

            // 处理数据行
            data.slice(config.dataStartRow).forEach(row => {
                const filteredRow = row.filter(cell => cell.trim() !== '');
                if (filteredRow.length === 0) return;

                const tr = document.createElement('tr');
                filteredRow.forEach(cell => {
                    const td = document.createElement('td');
                    td.textContent = cell;
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });

            table.appendChild(thead);
            table.appendChild(tbody);
            container.appendChild(table);

            // 初始按加权平均列排序
            const avgScoreCol = headers.findIndex(h => h.includes("加权平均"));
            if (avgScoreCol >= 0) {
                sortTable(avgScoreCol, headerRow.children[avgScoreCol]);
            }
        }

        // 排序功能
        let currentSort = { col: -1, asc: true };

        function sortTable(colIndex, thElement) {
            const table = document.querySelector('table');
            const rows = Array.from(table.querySelectorAll('tbody tr'));
            const icons = document.querySelectorAll('.sort-icon');

            // 更新排序状态
            if (currentSort.col === colIndex) {
                currentSort.asc = !currentSort.asc;
            } else {
                currentSort = { col: colIndex, asc: true };
            }

            // 更新排序图标
            icons.forEach(icon => icon.textContent = '↕');
            thElement.querySelector('.sort-icon').textContent = currentSort.asc ? '▲' : '▼';

            // 执行排序
            rows.sort((a, b) => {
                const aVal = a.cells[colIndex].textContent;
                const bVal = b.cells[colIndex].textContent;
                
                // 数值排序（如果是数字）
                if (!isNaN(parseFloat(aVal)) && !isNaN(parseFloat(bVal))) {
                    return currentSort.asc 
                        ? parseFloat(aVal) - parseFloat(bVal)
                        : parseFloat(bVal) - parseFloat(aVal);
                }
                // 文本排序
                return currentSort.asc 
                    ? aVal.localeCompare(bVal)
                    : bVal.localeCompare(aVal);
            });

            // 重新插入行
            const tbody = table.querySelector('tbody');
            rows.forEach(row => tbody.appendChild(row));
        }
    </script>
</body>
</html>
